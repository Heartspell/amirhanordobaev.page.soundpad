<!DOCTYPE html>
<html lang="ru" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <title>Что то вроде саундборда</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* стили как в предыдущем примере */
    button {
      transition: box-shadow 0.3s ease, background-color 0.3s ease, transform 0.3s ease;
      will-change: transform, box-shadow;
      user-select: none;
      border-radius: 0.375rem;
      font-weight: 600;
    }
    button:focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }
    .btn-play {
      background-color: #2563eb;
      box-shadow: 0 4px 6px rgb(37 99 235 / 0.5);
      color: white;
    }
    .btn-play:hover {
      background-color: #1d4ed8;
      box-shadow: 0 6px 10px rgb(29 78 216 / 0.7);
    }
    .btn-play:active {
      background-color: #1e40af;
      box-shadow: 0 2px 4px rgb(30 64 175 / 0.8);
      transform: scale(0.95);
    }
    .btn-pause {
      background-color: #f59e0b;
      box-shadow: 0 4px 6px rgb(245 158 11 / 0.5);
      color: white;
    }
    .btn-pause:hover {
      background-color: #d97706;
      box-shadow: 0 6px 10px rgb(217 119 6 / 0.7);
    }
    .btn-pause:active {
      background-color: #b45309;
      box-shadow: 0 2px 4px rgb(180 83 9 / 0.8);
      transform: scale(0.95);
    }
    .btn-delete {
      background-color: #dc2626;
      color: white;
      box-shadow: 0 4px 6px rgb(220 38 38 / 0.5);
    }
    .btn-delete:hover {
      background-color: #b91c1c;
      box-shadow: 0 6px 10px rgb(185 28 28 / 0.7);
    }
    .btn-delete:active {
      background-color: #991b1b;
      box-shadow: 0 2px 4px rgb(153 27 27 / 0.8);
      transform: scale(0.95);
    }
    .btn-stop {
      background-color: #ef4444;
      color: white;
      box-shadow: 0 4px 6px rgb(239 68 68 / 0.6);
    }
    .btn-stop:hover {
      background-color: #dc2626;
      box-shadow: 0 6px 10px rgb(220 38 38 / 0.8);
    }
    .btn-stop:active {
      background-color: #b91c1c;
      box-shadow: 0 2px 4px rgb(185 28 28 / 0.9);
      transform: scale(0.95);
    }
    .sound-card {
      background-color: #111827;
      border-radius: 0.5rem;
      padding: 1.25rem;
      box-shadow: 0 5px 15px rgb(0 0 0 / 0.7);
      user-select: none;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      opacity: 0;
      transform: translateY(15px);
      transition: opacity 0.4s ease, transform 0.4s ease;
      cursor: pointer;
    }
    .sound-card.show {
      opacity: 1;
      transform: translateY(0);
    }
    .sound-card:hover {
      box-shadow: 0 10px 25px rgb(37 99 235 / 0.8);
      transform: translateY(-5px);
    }
    .sound-card.selected {
      box-shadow: 0 0 15px 4px #60a5fa;
      transform: translateY(-5px);
      border: 2px solid #60a5fa;
    }
    .flex.items-center {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
    }
    .name-input {
      background-color: transparent;
      border: none;
      border-bottom: 2px solid #374151;
      color: #e0e7ff;
      font-size: 1.25rem;
      font-weight: 700;
      padding: 0.5rem 0.25rem;
      transition: border-color 0.3s ease;
      flex-grow: 1;
      min-width: 0;
      margin-right: 0.5rem;
    }
    .name-input::placeholder {
      color: #6b7280;
    }
    .name-input:focus {
      outline: none;
      border-bottom-color: #2563eb;
      color: #60a5fa;
      background-color: #1e40af33;
    }
    .keybind-input {
      width: 50px;
      text-align: center;
      background-color: transparent;
      border: none;
      border-bottom: 2px solid #374151;
      color: #a5b4fc;
      font-weight: 700;
      font-size: 1.25rem;
      padding: 0.3rem 0.2rem;
      cursor: pointer;
      transition: border-color 0.3s ease;
      user-select: none;
      border-radius: 0.25rem;
      flex-shrink: 0;
    }
    .keybind-input:focus {
      outline: none;
      border-bottom-color: #2563eb;
      color: #60a5fa;
      background-color: #1e40af33;
    }
    .progress {
      height: 6px;
      background-color: #374151;
      border-radius: 9999px;
      overflow: hidden;
      width: 100%;
    }
    .progress-bar {
      height: 100%;
      background-color: #2563eb;
      width: 0;
      border-radius: 9999px;
      transition: width 0.2s linear, opacity 0.4s ease;
      opacity: 0.8;
    }
    @keyframes spinJump {
      0% {
        transform: translateY(0) rotate(0deg);
      }
      30% {
        transform: translateY(-10px) rotate(90deg);
      }
      60% {
        transform: translateY(0) rotate(180deg);
      }
      100% {
        transform: translateY(0) rotate(360deg);
      }
    }
    .btn-play.animate {
      animation: spinJump 0.7s ease forwards;
    }
    #dropZone {
      border: 2px dashed #2563eb;
      border-radius: 0.75rem;
      padding: 3rem 1rem;
      text-align: center;
      color: #93c5fd;
      font-weight: 600;
      font-size: 1.25rem;
      user-select: none;
      cursor: pointer;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      margin-bottom: 1.5rem;
    }
    #dropZone:hover {
      background-color: #1e40af22;
      border-color: #1e40af;
      color: #bfdbfe;
    }
    #dropZone.dragover {
      background-color: #2563eb22;
      border-color: #2563eb;
      color: #60a5fa;
    }

    /* Пояснение управления */
    #controls-info {
      max-width: 600px;
      margin-top: 2rem;
      padding: 1rem 1.5rem;
      background: #1f2937;
      border-radius: 0.5rem;
      box-shadow: 0 0 10px #2563ebaa;
      font-size: 0.9rem;
      line-height: 1.4;
      color: #a5b4fc;
      user-select: none;
    }
    #controls-info b {
      color: #60a5fa;
    }
  </style>
</head>
<body class="flex flex-col items-center min-h-screen p-6 bg-gray-900 text-white">
  <h1 class="text-4xl font-extrabold mb-6 tracking-wide select-none" style="text-shadow: 0 0 6px #2563eb;">
    какой то там саундборд
  </h1>

  <div id="dropZone" tabindex="0">
    Перетащите MP3 сюда или нажмите, чтобы выбрать
    <input type="file" id="fileInput" accept="audio/*" multiple class="hidden" />
  </div>

  <div id="soundList" class="w-full max-w-4xl grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

  <div id="controls-info">
    <b>Управление клавишами при выделенном звуке:</b><br />
    • <b>Пробел</b> — воспроизведение / пауза<br />
    • <b>Enter</b> — воспроизведение с начала<br />
    • <b>S</b> — стоп<br />
    • <b>Delete</b> — удалить звук (с подтверждением)<br />
    • <b>Стрелки вверх / вниз</b> — переключение выделения между звуками<br /><br />
    <b>Если звук не выделен:</b> нажимайте назначенные клавиши для запуска звуков<br />
    <i>Кликните по карточке, чтобы выделить звук для управления</i><br /><br />
    <b>Клик по пустому месту (вне карточек) снимает выделение</b>
  </div>

  <script>
    const soundList = document.getElementById("soundList");
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");

    let sounds = JSON.parse(localStorage.getItem("sounds") || "[]");
    const playingAudios = new Map();

    renderSounds();

    function isValidKey(key) {
      return /^[a-z0-9]$/i.test(key);
    }

    let selectedSoundIndex = null;

    function selectSound(index) {
      if (selectedSoundIndex !== null) {
        soundList.children[selectedSoundIndex]?.classList.remove("selected");
      }
      selectedSoundIndex = index;
      if (selectedSoundIndex !== null) {
        soundList.children[selectedSoundIndex]?.classList.add("selected");
        soundList.children[selectedSoundIndex]?.scrollIntoView({ block: "nearest" });
      }
    }

    document.body.addEventListener("click", (e) => {
      const path = e.composedPath ? e.composedPath() : e.path || [];
      if (!path.some(el => el.classList && el.classList.contains && el.classList.contains("sound-card"))) {
        if (selectedSoundIndex !== null) {
          soundList.children[selectedSoundIndex]?.classList.remove("selected");
          selectedSoundIndex = null;
        }
      }
    });

    soundList.addEventListener("click", (e) => {
      e.stopPropagation();
      let card = e.target;
      while (card && !card.classList.contains("sound-card")) {
        card = card.parentElement;
      }
      if (!card) return;
      const index = Array.from(soundList.children).indexOf(card);
      if (index !== -1) selectSound(index);
    });

    function renderSounds() {
      soundList.innerHTML = "";
      sounds.forEach((sound, index) => {
        const card = document.createElement("div");
        card.className = "sound-card";

        setTimeout(() => card.classList.add("show"), 10);

        const titleContainer = document.createElement("div");
        titleContainer.className = "flex items-center";

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.value = sound.name;
        nameInput.placeholder = "Введите название";
        nameInput.className = "name-input flex-grow";
        nameInput.addEventListener("input", () => {
          sounds[index].name = nameInput.value;
          saveSounds();
        });

        const keybindInput = document.createElement("input");
        keybindInput.type = "text";
        keybindInput.maxLength = 1;
        keybindInput.placeholder = "-";
        keybindInput.className = "keybind-input";
        keybindInput.value = sound.keybind ? sound.keybind.toUpperCase() : "";
        keybindInput.title = "Нажмите клавишу для бинда";

        keybindInput.addEventListener("keydown", (e) => {
          e.preventDefault();
          const key = e.key.length === 1 ? e.key.toLowerCase() : "";
          if (key && isValidKey(key)) {
            const conflictIndex = sounds.findIndex(
              (s, i) => s.keybind === key && i !== index
            );
            if (conflictIndex !== -1) {
              alert(`Клавиша "${key.toUpperCase()}" уже назначена другому звуку.`);
              return;
            }
            sounds[index].keybind = key;
            keybindInput.value = key.toUpperCase();
            saveSounds();
          } else if (e.key === "Backspace" || e.key === "Delete") {
            sounds[index].keybind = "";
            keybindInput.value = "";
            saveSounds();
          }
        });

        titleContainer.appendChild(nameInput);
        titleContainer.appendChild(keybindInput);

        const controls = document.createElement("div");
        controls.className = "flex gap-3 mt-3";

        const playBtn = document.createElement("button");
        playBtn.title = "Воспроизвести с начала";
        playBtn.className = "btn-play";
        playBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
          <path d="M14.752 11.168l-6.518-3.75A1 1 0 007 8.168v7.664a1 1 0 001.234.97l6.518-3.75a1 1 0 000-1.664z"/>
        </svg>`;
        playBtn.onclick = () => {
          playSoundFromStart(sound);
          playBtn.classList.add("animate");
          setTimeout(() => playBtn.classList.remove("animate"), 700);
        };

        const pauseBtn = document.createElement("button");
        pauseBtn.title = "Пауза";
        pauseBtn.className = "btn-pause";
        pauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
          <rect x="6" y="4" width="4" height="16"></rect>
          <rect x="14" y="4" width="4" height="16"></rect>
        </svg>`;
        pauseBtn.onclick = () => {
          pauseSound(sound);
        };

        const stopBtn = document.createElement("button");
        stopBtn.title = "Стоп";
        stopBtn.className = "btn-stop";
        stopBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
          <rect x="6" y="6" width="12" height="12" rx="2" ry="2"/>
        </svg>`;
        stopBtn.onclick = () => {
          stopSound(sound);
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.title = "Удалить";
        deleteBtn.className = "btn-delete";
        deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
          <path d="M3 6h18"/>
          <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/>
          <path d="M10 11v6"/>
          <path d="M14 11v6"/>
          <path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"/>
        </svg>`;
        deleteBtn.onclick = () => {
          if (confirm(`Удалить звук "${sound.name}"?`)) {
            stopSound(sound);
            sounds.splice(index, 1);
            saveSounds();
            renderSounds();
            if (sounds.length === 0) {
              selectedSoundIndex = null;
            } else if (selectedSoundIndex >= sounds.length) {
              selectSound(sounds.length - 1);
            } else {
              selectSound(selectedSoundIndex);
            }
          }
        };

        controls.appendChild(playBtn);
        controls.appendChild(pauseBtn);
        controls.appendChild(stopBtn);
        controls.appendChild(deleteBtn);

        const progress = document.createElement("div");
        progress.className = "progress";
        const progressBar = document.createElement("div");
        progressBar.className = "progress-bar";
        progress.appendChild(progressBar);

        card.appendChild(titleContainer);
        card.appendChild(controls);
        card.appendChild(progress);

        soundList.appendChild(card);

        if (!sound.audio) {
          const audio = new Audio(sound.url);
          audio.preload = "auto";
          sound.audio = audio;

          audio.addEventListener("timeupdate", () => {
            const progressPercent = (audio.currentTime / audio.duration) * 100 || 0;
            progressBar.style.width = progressPercent + "%";
          });
          audio.addEventListener("ended", () => {
            progressBar.style.width = "0%";
            playingAudios.delete(sound);
          });
        }
      });
    }

    function saveSounds() {
      const soundsToSave = sounds.map(({ name, url, keybind }) => ({ name, url, keybind }));
      localStorage.setItem("sounds", JSON.stringify(soundsToSave));
    }

    function playSoundFromStart(sound) {
      if (!sound.audio) return;
      stopSound(sound); 
      sound.audio.currentTime = 0;
      sound.audio.play();
      playingAudios.set(sound, { audio: sound.audio });
    }

    function playSound(sound) {
      if (!sound.audio) return;
      if (!playingAudios.has(sound)) {
        playingAudios.set(sound, { audio: sound.audio });
      }
      sound.audio.play();
    }

    function pauseSound(sound) {
      if (!sound.audio) return;
      sound.audio.pause();
      playingAudios.delete(sound);
    }

    function stopSound(sound) {
      if (!sound.audio) return;
      sound.audio.pause();
      sound.audio.currentTime = 0;
      playingAudios.delete(sound);
    }

    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("dragover");
      const files = Array.from(e.dataTransfer.files);
      loadFiles(files);
    });

    dropZone.addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", () => {
      loadFiles(Array.from(fileInput.files));
      fileInput.value = "";
    });

    function loadFiles(files) {
      files.forEach((file) => {
        if (!file.type.startsWith("audio")) return;
        const url = URL.createObjectURL(file);
        sounds.push({
          name: file.name.replace(/\.[^/.]+$/, ""),
          url,
          keybind: "",
          audio: null,
        });
      });
      saveSounds();
      renderSounds();
    }

    document.addEventListener("keydown", (e) => {
      if (
        e.target.tagName.toLowerCase() === "input" ||
        e.target.tagName.toLowerCase() === "textarea"
      )
        return;

      const key = e.key.toLowerCase();

      if (selectedSoundIndex !== null) {
        const selectedSound = sounds[selectedSoundIndex];

        switch (key) {
          case " ":
            e.preventDefault();
            if (selectedSound.audio.paused) {
              playSound(selectedSound);
            } else {
              pauseSound(selectedSound);
            }
            break;
          case "enter":
            e.preventDefault();
            playSoundFromStart(selectedSound);
            break;
          case "s":
            e.preventDefault();
            stopSound(selectedSound);
            break;
          case "delete":
            e.preventDefault();
            if (confirm(`Удалить звук "${selectedSound.name}"?`)) {
              const card = soundList.children[selectedSoundIndex];
              card.style.transition = "opacity 0.5s ease, transform 0.5s ease";
              card.style.opacity = "0";
              card.style.transform = "translateY(20px)";
              setTimeout(() => {
                stopSound(selectedSound);
                sounds.splice(selectedSoundIndex, 1);
                saveSounds();
                renderSounds();
                if (sounds.length === 0) {
                  selectedSoundIndex = null;
                } else if (selectedSoundIndex >= sounds.length) {
                  selectSound(sounds.length - 1);
                } else {
                  selectSound(selectedSoundIndex);
                }
              }, 500);
            }
            break;
          case "arrowdown":
            e.preventDefault();
            let nextIndex = selectedSoundIndex + 1;
            if (nextIndex >= sounds.length) nextIndex = 0;
            selectSound(nextIndex);
            break;
          case "arrowup":
            e.preventDefault();
            let prevIndex = selectedSoundIndex - 1;
            if (prevIndex < 0) prevIndex = sounds.length - 1;
            selectSound(prevIndex);
            break;
        }
      } else {
        const sound = sounds.find(
          (s) => s.keybind && s.keybind.toLowerCase() === key
        );
        if (sound) {
          playSound(sound);
        }
      }
    });
  </script>
</body>
</html>
